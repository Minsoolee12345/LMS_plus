<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layout :: head}">
  <meta charset="UTF-8"/>
  <title>메시지 센터</title>
  <style>
    table, th, td { border:1px solid #666; border-collapse: collapse; padding:5px; }
    textarea { width:100%; height:80px; }
    .delete-btn { cursor:pointer; }
    form.delete-form { display:inline; }
  </style>
</head>
<body>
  <div th:replace="~{layout :: header}"></div>
  <div class="layout">
    <main class="content">

     <div class="container" style="margin-top:30px;">
  <h1 class="text-primary" th:text="${currentUser.username} + ' 님의 메시지 센터'">메시지 센터</h1>

  <!-- 받은 메시지 -->
  <h2 class="text-info">받은 메시지</h2>
  <table class="table table-bordered table-striped table-hover">
    <thead>
      <tr><th>ID</th><th>발신자</th><th>내용</th><th>시간</th><th>삭제</th></tr>
    </thead>
    <tbody th:if="${recvMessages.empty}">
      <tr><td colspan="5" class="text-center text-muted">받은 메시지가 없습니다.</td></tr>
    </tbody>
    <tbody th:each="msg : ${recvMessages}">
      <tr>
        <td th:text="${msg.id}"></td>
        <td th:text="${msg.sender.username}"></td>
        <td th:text="${msg.content}"></td>
        <td th:text="${#temporals.format(msg.createdDate,'yyyy-MM-dd HH:mm:ss')}"></td>
        <td>
          <form th:action="@{/user/messages/delete}" method="post" style="display:inline;">
            <input type="hidden" name="messageId" th:value="${msg.id}" />
            <button type="submit" class="btn btn-danger btn-sm">삭제</button>
          </form>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- 보낸 메시지 -->
  <h2 class="text-info">보낸 메시지</h2>
  <table class="table table-bordered table-striped table-hover">
    <thead>
      <tr><th>ID</th><th>수신자</th><th>내용</th><th>시간</th><th>삭제</th></tr>
    </thead>
    <tbody th:if="${sentMessages.empty}">
      <tr><td colspan="5" class="text-center text-muted">보낸 메시지가 없습니다.</td></tr>
    </tbody>
    <tbody th:each="msg : ${sentMessages}">
      <tr>
        <td th:text="${msg.id}"></td>
        <td th:text="${msg.receiver.username}"></td>
        <td th:text="${msg.content}"></td>
        <td th:text="${#temporals.format(msg.createdDate,'yyyy-MM-dd HH:mm:ss')}"></td>
        <td>
          <form th:action="@{/user/messages/delete}" method="post" style="display:inline;">
            <input type="hidden" name="messageId" th:value="${msg.id}" />
            <button type="submit" class="btn btn-danger btn-sm">삭제</button>
          </form>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- 자신에게 보낸 메시지 -->
  <h2 class="text-info">자신에게 보낸 메시지</h2>
  <table class="table table-bordered table-striped table-hover">
    <thead>
      <tr><th>ID</th><th>발신자</th><th>수신자</th><th>내용</th><th>시간</th><th>삭제</th></tr>
    </thead>
    <tbody th:if="${selfMessages.empty}">
      <tr><td colspan="6" class="text-center text-muted">자신에게 보낸 메시지가 없습니다.</td></tr>
    </tbody>
    <tbody th:each="msg : ${selfMessages}">
      <tr>
        <td th:text="${msg.id}"></td>
        <td th:text="${msg.sender.username}"></td>
        <td th:text="${msg.receiver.username}"></td>
        <td th:text="${msg.content}"></td>
        <td th:text="${#temporals.format(msg.createdDate,'yyyy-MM-dd HH:mm:ss')}"></td>
        <td>
          <form th:action="@{/user/messages/delete}" method="post" style="display:inline;">
            <input type="hidden" name="messageId" th:value="${msg.id}" />
            <button type="submit" class="btn btn-danger btn-sm">삭제</button>
          </form>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- 메시지 보내기 -->
  <h2 class="text-success">메시지 보내기</h2>
  <form th:action="@{/user/sendMessage}" method="post" class="form-horizontal">
    <div class="form-group">
      <label class="col-sm-2 control-label">받는 사람:</label>
      <div class="col-sm-10">
        <select name="receiverId" class="form-control" required>
          <option th:each="u : ${allUsers}" th:value="${u.id}" th:text="${u.username}"></option>
        </select>
      </div>
    </div>
    <div class="form-group">
      <label class="col-sm-2 control-label">내용:</label>
      <div class="col-sm-10">
        <textarea name="content" class="form-control" rows="4" placeholder="메시지를 입력하세요..." required></textarea>
      </div>
    </div>
    <div class="form-group">
      <div class="col-sm-offset-2 col-sm-10">
        <button type="submit" class="btn btn-primary">보내기</button>
      </div>
    </div>
  </form>

  <p><a th:href="@{/}">메인으로 돌아가기</a></p>
</div>
    </main>
  </div>
</body>
</html>
